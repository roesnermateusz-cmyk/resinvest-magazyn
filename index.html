<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="System zarzƒÖdzania magazynem ResInvest Commodities - Magazyn Pyskowice">
    <meta name="theme-color" content="#2563EB">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ResInvest">
    
    <title>ResInvest Commodities - System Magazynowy</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" href="icon-192.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
        }
        .tab-button.active {
            background-color: #EFF6FF !important;
            color: #2563EB !important;
            border-bottom: 2px solid #2563EB !important;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block !important;
        }
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body class="bg-gray-50">
    
    <div class="bg-blue-600 text-white p-6 shadow-lg">
        <h1 class="text-2xl font-bold">ResInvest Commodities</h1>
        <p class="text-blue-100">Magazyn Pyskowice</p>
    </div>

    <div class="bg-white shadow-md overflow-x-auto no-print">
        <div class="flex min-w-max">
            <button onclick="switchTab('magazyn')" class="tab-button active flex items-center gap-2 px-6 py-4 font-medium transition-colors text-gray-600 hover:bg-gray-50">
                <span>üì¶</span><span>Stan Magazynowy</span>
            </button>
            <button onclick="switchTab('dokumenty')" class="tab-button flex items-center gap-2 px-6 py-4 font-medium transition-colors text-gray-600 hover:bg-gray-50">
                <span>üìÑ</span><span>Dokumenty</span>
            </button>
            <button onclick="switchTab('kalkulator')" class="tab-button flex items-center gap-2 px-6 py-4 font-medium transition-colors text-gray-600 hover:bg-gray-50">
                <span>üßÆ</span><span>Kalkulator mp</span>
            </button>
            <button onclick="switchTab('obecnosc')" class="tab-button flex items-center gap-2 px-6 py-4 font-medium transition-colors text-gray-600 hover:bg-gray-50">
                <span>üë•</span><span>Obecno≈õƒá</span>
            </button>
            <button onclick="switchTab('historia')" class="tab-button flex items-center gap-2 px-6 py-4 font-medium transition-colors text-gray-600 hover:bg-gray-50">
                <span>üìä</span><span>Historia</span>
            </button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto p-4 md:p-6">
        
        <!-- Stan Magazynowy -->
        <div id="tab-magazyn" class="tab-content active">
            <div class="space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">Stan Magazynowy</h2>
                    <button onclick="generateWarehousePDF()" class="no-print bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                        ‚¨áÔ∏è Generuj raport
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-green-50 border-2 border-green-200 rounded-lg p-6">
                        <h3 class="text-green-800 font-semibold mb-2">PZ w tym miesiƒÖcu</h3>
                        <p class="text-3xl font-bold text-green-600" id="monthly-pz">0.00 m¬≥</p>
                    </div>
                    <div class="bg-red-50 border-2 border-red-200 rounded-lg p-6">
                        <h3 class="text-red-800 font-semibold mb-2">WZ w tym miesiƒÖcu</h3>
                        <p class="text-3xl font-bold text-red-600" id="monthly-wz">0.00 m¬≥</p>
                    </div>
                    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6">
                        <h3 class="text-blue-800 font-semibold mb-2">Stan aktualny</h3>
                        <p class="text-3xl font-bold text-blue-600" id="current-stock">0.00 m¬≥</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dokumenty -->
        <div id="tab-dokumenty" class="tab-content">
            <div class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">Dokumenty magazynowe</h2>
                
                <div id="doc-buttons" class="flex gap-4">
                    <button onclick="showDocForm('PZ')" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700">
                        Nowe PZ (Przyjƒôcie)
                    </button>
                    <button onclick="showDocForm('WZ')" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700">
                        Nowe WZ (Wydanie)
                    </button>
                </div>

                <div id="doc-form" class="hidden bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800" id="doc-form-title"></h3>
                        <button onclick="hideDocForm()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
                    </div>

                    <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                        <p class="text-sm text-gray-700">Numer dokumentu: <strong id="doc-number-preview"></strong></p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Data wystawienia</label>
                            <input type="date" id="doc-data-wyst" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" id="doc-data-label">Data</label>
                            <input type="date" id="doc-data-trans" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nr rejestracyjny pojazdu</label>
                            <input type="text" id="doc-nr-rej" placeholder="GLE 1234" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Oznaczenie towaru</label>
                            <input type="text" id="doc-oznaczenie" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ilo≈õƒá (m¬≥)</label>
                            <input type="number" step="0.01" id="doc-ilosc" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" id="doc-kontr-label">Kontrahent</label>
                            <input type="text" id="doc-kontrahent" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" id="doc-podpis-label">Podpis</label>
                            <input type="text" id="doc-podpis" class="w-full border rounded-lg px-3 py-2">
                        </div>
                    </div>

                    <div class="mt-6">
                        <button onclick="saveDocument()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                            üíæ Zapisz dokument
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kalkulator -->
        <div id="tab-kalkulator" class="tab-content">
            <div class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">Kalkulator metr√≥w przestrzennych</h2>
                <div class="bg-white rounded-lg shadow-lg p-6 max-w-md">
                    <p class="text-gray-600 mb-2">Oblicz objƒôto≈õƒá zrƒôbki drzewnej</p>
                    <p class="text-sm text-gray-500 mb-4">Wz√≥r: D≈Çugo≈õƒá √ó Szeroko≈õƒá √ó Wysoko≈õƒá</p>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">D≈Çugo≈õƒá (m)</label>
                            <input type="number" step="0.01" id="calc-d" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Szeroko≈õƒá (m)</label>
                            <input type="number" step="0.01" id="calc-s" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Wysoko≈õƒá (m)</label>
                            <input type="number" step="0.01" id="calc-h" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <button onclick="calculate()" class="w-full bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700">
                            Oblicz objƒôto≈õƒá
                        </button>
                        <div id="calc-wynik" class="hidden bg-green-50 border-2 border-green-200 rounded-lg p-4">
                            <p class="text-sm text-gray-600 mb-1">Wynik:</p>
                            <p class="text-3xl font-bold text-green-600" id="calc-value"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Obecno≈õƒá -->
        <div id="tab-obecnosc" class="tab-content">
            <div id="emp-list" class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-800">Lista Obecno≈õci</h2>
                
                <div class="bg-white rounded-lg shadow-lg p-6 max-w-md">
                    <h3 class="font-bold text-lg mb-4">Dodaj pracownika</h3>
                    <div class="flex gap-2">
                        <input type="text" id="new-emp" placeholder="Imiƒô i nazwisko" class="flex-1 border rounded-lg px-3 py-2">
                        <button onclick="addEmployee()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            ‚ûï Dodaj
                        </button>
                    </div>
                </div>

                <div class="space-y-3">
                    <h3 class="font-bold text-lg">Pracownicy</h3>
                    <div id="emp-container"></div>
                </div>
            </div>

            <div id="month-view" class="hidden space-y-6">
                <div class="flex items-center gap-4">
                    <button onclick="backToEmpList()" class="text-blue-600 hover:text-blue-800 font-medium">‚Üê Powr√≥t</button>
                    <h2 class="text-2xl font-bold text-gray-800" id="emp-name-title"></h2>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="months-grid"></div>
            </div>

            <div id="calendar-view" class="hidden space-y-6">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-4">
                        <button onclick="backToMonths()" class="text-blue-600 hover:text-blue-800 font-medium">‚Üê Powr√≥t</button>
                        <h2 class="text-2xl font-bold text-gray-800" id="calendar-title"></h2>
                    </div>
                    <div class="flex gap-2 no-print">
                        <button onclick="printCalendar()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            üñ®Ô∏è Drukuj
                        </button>
                        <button onclick="exportCalendar()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                            ‚¨áÔ∏è PDF
                        </button>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Data</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Pracownik</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Godziny</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Podpis</th>
                                </tr>
                            </thead>
                            <tbody id="calendar-body"></tbody>
                        </table>
                    </div>
                </div>
                <div class="flex justify-end no-print">
                    <button onclick="saveAttendance()" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 text-lg font-medium">
                        üíæ Zapisz wszystkie zmiany
                    </button>
                </div>
            </div>
        </div>

        <!-- Historia -->
        <div id="tab-historia" class="tab-content">
            <div class="space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">Historia dokument√≥w</h2>
                    <button onclick="generateHistoryPDF()" class="no-print bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                        ‚¨áÔ∏è Generuj raport
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="font-bold text-lg mb-4">Podsumowanie</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="border-l-4 border-green-500 pl-4">
                            <p class="text-sm text-gray-600">≈ÅƒÖczne PZ</p>
                            <p class="text-2xl font-bold text-green-600" id="total-pz">0.00 m¬≥</p>
                        </div>
                        <div class="border-l-4 border-red-500 pl-4">
                            <p class="text-sm text-gray-600">≈ÅƒÖczne WZ</p>
                            <p class="text-2xl font-bold text-red-600" id="total-wz">0.00 m¬≥</p>
                        </div>
                        <div class="border-l-4 border-blue-500 pl-4">
                            <p class="text-sm text-gray-600">Stan</p>
                            <p class="text-2xl font-bold text-blue-600" id="total-stock">0.00 m¬≥</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Typ</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Numer</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nr rej.</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Oznaczenie</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ilo≈õƒá</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Kontrahent</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Podpis</th>
                                </tr>
                            </thead>
                            <tbody id="history-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DANE GLOBALNE
        let docs = [];
        let employees = [];
        let attendance = {};
        let pzCnt = 1;
        let wzCnt = 1;
        let currentDocType = '';
        let selectedEmp = null;
        let selectedMth = null;
        let pendingChanges = {};

        const months = ['Stycze≈Ñ','Luty','Marzec','Kwiecie≈Ñ','Maj','Czerwiec','Lipiec','Sierpie≈Ñ','Wrzesie≈Ñ','Pa≈∫dziernik','Listopad','Grudzie≈Ñ'];
        const empList = ['Mateusz Roesner','Jan Kowalski','Anna Nowak','Piotr Wi≈õniewski','Krzysztof Kowalczyk'];
        const hours = ['6-14','7-15','8-16','9-17','10-18','14-22','15-23','16-00','22-6','23-7','Urlop','Zwolnienie','Wolne','-'];

        // INICJALIZACJA
        document.addEventListener('DOMContentLoaded', () => {
            loadFromStorage();
            updateStats();
            renderEmployees();
            updateHistory();
        });

        // STORAGE
        function loadFromStorage() {
            try {
                docs = JSON.parse(localStorage.getItem('docs') || '[]');
                employees = JSON.parse(localStorage.getItem('employees') || '[]');
                attendance = JSON.parse(localStorage.getItem('attendance') || '{}');
                pzCnt = parseInt(localStorage.getItem('pzCnt') || '1');
                wzCnt = parseInt(localStorage.getItem('wzCnt') || '1');
            } catch(e) { console.error('Load error:', e); }
        }

        function saveToStorage() {
            localStorage.setItem('docs', JSON.stringify(docs));
            localStorage.setItem('employees', JSON.stringify(employees));
            localStorage.setItem('attendance', JSON.stringify(attendance));
            localStorage.setItem('pzCnt', pzCnt);
            localStorage.setItem('wzCnt', wzCnt);
        }

        // ZAK≈ÅADKI
        function switchTab(name) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            const tab = document.getElementById('tab-' + name);
            if (tab) tab.classList.add('active');
            
            event.target.closest('.tab-button').classList.add('active');
            
            if (name === 'magazyn') updateStats();
            if (name === 'historia') updateHistory();
            if (na
